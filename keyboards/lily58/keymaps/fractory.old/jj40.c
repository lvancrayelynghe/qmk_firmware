#include QMK_KEYBOARD_H

// #include "keymap_french.h"
// #include "keymap_french_osx.h"
#include "sendstring_french_osx.h"

enum layers {
  _AZERTY = 0,
  _LOWER,
  _RAISE,
  _MAKRO,
  _FN1,
  _FN2,
  _ADJUST,
};

enum custom_macros {
  WD_SLC = 0,
  LN_SLC,
  LN_DEL,
  LN_DUP,
  P_ARR,
  P_THIS,
};

enum tap_dances {
  TD_SHIFT_CAPS = 0,
};

/* Layers */
#define LOWER  MO(_LOWER)
#define RAISE  MO(_RAISE)
#define MAKRO  MO(_MAKRO)
#define FN1    MO(_FN1)
#define FN2    MO(_FN2)

/* Tap Dances */
#define TD_SC TD(TD_SHIFT_CAPS)

/* Custom Keycodes */
#define MY_LSRT LGUI(KC_LEFT)
#define MY_LEND LGUI(KC_RIGHT)

/* Custom FR_OSX Overrides */
#define MY_EURO LALT(FR_DLR)
#define MY_HASH LALT(LSFT(FR_GRV))
#define MY_AT   LALT(FR_GRV)
#define MY_DEG  LSFT(FR_RPRN)
#define MY_LABK FR_AT
#define MY_RABK LSFT(FR_AT)
#define MY_LOCK LGUI(LCTL(FR_Q))

const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {

/* Azerty
 * ,-----------------------------------------------------------------------------------.
 * | Esc  |   A  |   Z  |   E  |   R  |   T  |   Y  |   U  |   I  |   O  |   P  | Bksp |
 * |------+------+------+------+------+-------------+------+------+------+------+------|
 * | Tab  |   Q  |   S  |   D  |   F  |   G  |   H  |   J  |   K  |   L  |   M  | Enter|
 * |------+------+------+------+------+------|------+------+------+------+------+------|
 * | Shift|   W  |   X  |   C  |   V  |   B  |   N  |   ,  |   ;  |   :  |  Up  | FN1  |
 * |------+------+------+------+------+------+------+------+------+------+------+------|
 * | Ctrl | Alt  | CMD  | MACRO| Lower|    Space    | Raise| FN2  | Left | Down | Right|
 * `-----------------------------------------------------------------------------------'
 */
[_AZERTY] = LAYOUT_planck_mit( \
  KC_ESC,  FR_A,    FR_Z,    KC_E,    KC_R,    KC_T,    KC_Y,    KC_U,    KC_I,    KC_O,    KC_P,    KC_BSPC, \
  KC_TAB,  FR_Q,    KC_S,    KC_D,    KC_F,    KC_G,    KC_H,    KC_J,    KC_K,    KC_L,    FR_M,    KC_ENT,  \
  TD_SC,   FR_W,    KC_X,    KC_C,    KC_V,    KC_B,    KC_N,    FR_COMM, FR_SCLN, FR_COLN, KC_UP,   FN1,     \
  MAKRO,   KC_LCTL, KC_LALT, KC_LGUI, LOWER,       KC_SPC,       RAISE,   FN2,     KC_LEFT, KC_DOWN, KC_RGHT  \
),

/* Lower
 * ,-----------------------------------------------------------------------------------.
 * |      |   à  |      |   è  |      |   [  |   ]  |   ù  |      |      |   _  |  Del |
 * |------+------+------+------+------+-------------+------+------+------+------+------|
 * |      |      |      |      |      |      |   #  |      |      |      |      |      |
 * |------+------+------+------+------+------|------+------+------+------+------+------|
 * |      |      |      |   ç  |      |      |      |      |      |   *  |  pUp |      |
 * |------+------+------+------+------+------+------+------+------+------+------+------|
 * |      |      |      |      | HOLD |             |      |      | Home |  pDn |  End |
 * `-----------------------------------------------------------------------------------'
 */
[_LOWER] = LAYOUT_planck_mit( \
  _______, FR_AGRV, _______, FR_EGRV, _______, FR_LBRC, FR_RBRC, FR_UGRV, _______, _______, FR_UNDS, KC_DEL,  \
  _______, _______, _______, _______, _______, XXXXXXX, MY_HASH, _______, _______, _______, _______, _______, \
  _______, _______, _______, FR_CCED, _______, _______, _______, _______, _______, FR_ASTR, KC_PGUP, _______, \
  _______, _______, _______, _______, _______,      _______,     _______, _______, MY_LSRT, KC_PGDN, MY_LEND  \
),

/* Raise
 * ,-----------------------------------------------------------------------------------.
 * |      |   @  |   &  |   é  |      |   (  |   )  |      |   !  |      |   -  |      |
 * |------+------+------+------+------+-------------+------+------+------+------+------|
 * |      |      |      |   $  |      |   <  |   >  |      |      |      |   ^  |      |
 * |------+------+------+------+------+------|------+------+------+------+------+------|
 * |      |   '  |   "  |   `  |      |   {  |   }  |      |      |   %  |      |      |
 * |------+------+------+------+------+------+------+------+------+------+------+------|
 * |      |      |      |      |      |             | HOLD |      |      |      |      |
 * `-----------------------------------------------------------------------------------'
 */
[_RAISE] = LAYOUT_planck_mit( \
  _______, MY_AT,   FR_AMP,  FR_EACU, _______, FR_LPRN, FR_RPRN, _______, FR_EXLM, _______, FR_MINS, _______, \
  _______, _______, _______, FR_DLR,  _______, MY_LABK, MY_RABK, _______, _______, _______, FR_CIRC, _______, \
  _______, FR_APOS, FR_QUOT, FR_GRV,  _______, FR_LCBR, FR_RCBR, _______, _______, FR_PERC, _______, _______, \
  _______, _______, _______, _______, _______,      _______,     _______, _______, _______, _______, _______  \
),

/* FN1
 * ,-----------------------------------------------------------------------------------.
 * |      |  lC  |  mU  |  rC  |  sU  |      |      |      |      |      |      |      |
 * |------+------+------+------+------+-------------+------+------+------+------+------|
 * |      |  mL  |  mD  |  mR  |  sD  |      |      |      |      |      |      |      |
 * |------+------+------+------+------+------|------+------+------+------+------+------|
 * |      |      |      |      |      |      |      |      |  lC  |  rC  |  pUp | HOLD |
 * |------+------+------+------+------+------+------+------+------+------+------+------|
 * |      |      |      |      |      |             |      |      |      |  pDn |      |
 * `-----------------------------------------------------------------------------------'
 */
[_FN1] = LAYOUT_planck_mit( \
  _______, KC_BTN1, KC_MS_U, KC_BTN2, KC_WH_D, _______, _______, _______, _______, _______, _______, _______, \
  _______, KC_MS_L, KC_MS_D, KC_MS_R, KC_WH_U, _______, _______, _______, _______, _______, _______, _______, \
  _______, _______, _______, _______, _______, _______, _______, _______, KC_BTN1, KC_BTN2, KC_PGUP, _______, \
  _______, _______, _______, _______, _______,      _______,     _______, _______, _______, KC_PGDN, _______  \
),

/* FN2
 * ,-----------------------------------------------------------------------------------.
 * |      |   1  |   2  |   3  |   4  |   5  |   6  |   7  |   8  |   9  |   0  |      |
 * |------+------+------+------+------+-------------+------+------+------+------+------|
 * |      |      |      |      |      |      |      |      |      |      |      |   =  |
 * |------+------+------+------+------+------|------+------+------+------+------+------|
 * |      |      |      |      |      |      |      |      |      |      |      |      |
 * |------+------+------+------+------+------+------+------+------+------+------+------|
 * |      |      |      |      |      |             |      | HOLD |      |      |      |
 * `-----------------------------------------------------------------------------------'
 */
[_FN2] = LAYOUT_planck_mit( \
  _______, FR_1,    FR_2,    FR_3,    FR_4,    FR_5,    FR_6,    FR_7,    FR_8,    FR_9,    FR_0,    _______, \
  _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, FR_EQL,  \
  _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, \
  _______, _______, _______, _______, _______,      _______,     _______, _______, _______, _______, _______  \
),

/* ADJUST
 * ,-----------------------------------------------------------------------------------.
 * | Lock |  F1  |  F2  |  F3  |  F4  |      |      |  Bu  |  Tp  |  Tn  |  Tp  |      |
 * |------+------+------+------+------+-------------+------+------+------+------+------|
 * |      |  F5  |  F6  |  F7  |  F8  |      |      |  Bd  |  v-  |  v+  |  vM  |      |
 * |------+------+------+------+------+------|------+------+------+------+------+------|
 * |      |  F9  |  F10 |  F11 |  F12 |      |      |      |  b-  |  b+  |  bT  |      |
 * |------+------+------+------+------+------+------+------+------+------+------+------|
 * |      |      |      |      | HOLD |             | HOLD |      |      |      |      |
 * `-----------------------------------------------------------------------------------'
 */
[_ADJUST] = LAYOUT_planck_mit( \
  MY_LOCK, KC_F1,   KC_F2,   KC_F3,   KC_F4,   _______, _______, KC_BRIU, KC_MRWD, KC_MFFD, KC_MPLY, _______, \
  _______, KC_F5,   KC_F6,   KC_F7,   KC_F10,  _______, _______, KC_BRID, KC_VOLD, KC_VOLU, KC_MUTE, _______, \
  _______, KC_F5,   KC_F10,  KC_F11,  KC_F12,  _______, _______, _______, BL_DEC,  BL_INC,  BL_TOGG, _______, \
  _______, _______, _______, _______, _______,      _______,     _______, _______, _______, _______, _______  \
),

/* MAKRO
 * ,-----------------------------------------------------------------------------------.
 * |      |      |      |      |      |      |      |      |      |      |      |      |
 * |------+------+------+------+------+-------------+------+------+------+------+------|
 * |      |      |      |      |      |      |      |      |      |      |      |      |
 * |------+------+------+------+------+------|------+------+------+------+------+------|
 * |      |      |      |      |      |      |      |      |      |      |      |      |
 * |------+------+------+------+------+------+------+------+------+------+------+------|
 * |      |      |      |      |      |             |      |      |      |      |      |
 * `-----------------------------------------------------------------------------------'
 * TODO
 */

[_MAKRO] = LAYOUT_planck_mit( \
  _______, _______, _______, _______, _______, P_THIS,  _______, _______, _______, _______, _______, KC_DEL,  \
  _______, _______, _______, LN_DEL,  _______, _______, _______, _______, _______, LN_SLC,  _______, _______, \
  _______, WD_SLC,  _______, LN_DUP,  _______, _______, _______, _______, _______, _______, _______, _______, \
  _______, _______, _______, _______, _______,      _______,     _______, _______, _______, _______, _______  \
),

};

void matrix_init_user() {
    backlight_level(4);
    rgblight_disable();
}

uint32_t layer_state_set_user(uint32_t state) {
  return update_tri_layer_state(state, _LOWER, _RAISE, _ADJUST);
}

bool process_record_user(uint16_t keycode, keyrecord_t *record) {
  switch(keycode) {
    case WD_SLC:
      if (record->event.pressed) {
        SEND_STRING(SS_DOWN(X_LALT) SS_TAP(X_RIGHT) SS_DOWN(X_LSHIFT) SS_TAP(X_LEFT) SS_UP(X_LSHIFT) SS_UP(X_LALT));
      }
      break;

    // case LN_SLC:
    //   if (record->event.pressed) {
    //     SEND_STRING(SS_LCTRL("a") SS_DOWN(X_LSHIFT) SS_LCTRL("e") SS_UP(X_LSHIFT));
    //   }
    //   break;

    case LN_DEL:
      if (record->event.pressed) {
        SEND_STRING(SS_LCTRL("a") SS_DOWN(X_LSHIFT) SS_LCTRL("e") SS_UP(X_LSHIFT));
        SEND_STRING(SS_TAP(X_BSPACE));
      }
      break;

    case LN_DUP:
      if (record->event.pressed) {
        SEND_STRING(SS_LGUI("c") SS_TAP(X_END) SS_LGUI("v"));
      }
      break;

    // case P_THIS:
    //   if (record->event.pressed) {
    //     SEND_STRING("$this");
    //   }
    //   break;

    // case P_ARR:
    //   if (record->event.pressed) {
    //     SEND_STRING("->");
    //   }
    //   break;
  }

  return true;
}

qk_tap_dance_action_t tap_dance_actions[] = {
  [TD_SHIFT_CAPS] = ACTION_TAP_DANCE_DOUBLE(KC_LSFT, KC_CAPS)
};
